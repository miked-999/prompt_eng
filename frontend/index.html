<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Prompt Engineering Trainer</title>
    <style>
      *, *::before, *::after { box-sizing: border-box; }
      :root { --bg:#0b1020; --card:#151b2e; --text:#e6e9f2; --muted:#a6accd; --accent:#6ab7ff; --bad:#ff6b6b; --ok:#ffd166; --good:#06d6a0; }
      body { margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji"; background:var(--bg); color:var(--text); }
      .container { max-width: 1000px; margin: 0 auto; padding: 24px; }
      .card { background: var(--card); border-radius: 12px; padding: 16px 18px; box-shadow: 0 2px 12px rgba(0,0,0,.2); }
      h1 { font-size: 22px; margin: 0 0 8px; }
      p.muted { color: var(--muted); margin-top: 0; }
      textarea, input, select { width: 100%; background:#0f1425; color:var(--text); border:1px solid #26304d; border-radius:8px; padding:10px; }
      textarea { min-height: 140px; }
      button { background: var(--accent); color:#001027; border:0; border-radius:8px; padding:10px 14px; cursor:pointer; font-weight:600; }
      button.ghost { background: transparent; color: var(--accent); border:1px solid var(--accent); }
      button:disabled { opacity: 0.5; cursor: not-allowed; }
      .row { display:flex; gap:12px; align-items:center; }
      .row > * { flex: 1; }
      .tabs { display:flex; gap:8px; margin: 12px 0 16px; }
      .tab { padding: 8px 12px; border-radius: 999px; border:1px solid #2a3556; cursor: pointer; color: var(--muted); }
      .tab.active { background:#1a2240; color: var(--text); border-color:#3b4c77; }
      .pill { display:inline-block; padding:2px 8px; border-radius:999px; font-size:12px; }
      .pill.bad { background: rgba(255,107,107,.2); color: var(--bad); }
      .pill.ok { background: rgba(255,209,102,.2); color: var(--ok); }
      .pill.good { background: rgba(6,214,160,.2); color: var(--good); }
      .grid { display:grid; grid-template-columns: repeat(12, minmax(0, 1fr)); gap: 12px; }
      .col-6 { grid-column: span 6; }
      .col-8 { grid-column: span 8; }
      .col-4 { grid-column: span 4; }
      .grid.tight { gap: 8px; }
      .section-title { font-weight:700; margin: 12px 0 8px; font-size: 14px; color: var(--muted); }
      .section-title.small { margin: 6px 0 6px; }
      ul { margin: 0; padding-left: 16px; }
      .suggestion { border-left: 2px solid #2e3b63; padding-left: 10px; margin: 8px 0; }
      .score { font-size: 36px; font-weight: 800; }
      .subscore { display:flex; justify-content: space-between; border-bottom:1px dashed #283355; padding: 6px 0; }
      .subscore:last-child { border-bottom: 0; }
      .emoji { font-size: 20px; }
      .attr.bad { color: var(--bad); }
      .attr.ok { color: var(--ok); }
      .attr.good { color: var(--good); }
      .quiz-item { border:1px solid #2a3556; border-radius:10px; padding:12px; margin:8px 0; background:#0f1425; }
      .choices { display:flex; gap:8px; }
      .choices button { flex:1; }
      
      .spinner { width:16px; height:16px; border:2px solid #3b4c77; border-top-color: var(--accent); border-radius:50%; display:inline-block; animation: spin .8s linear infinite; }
      @keyframes spin { from { transform: rotate(0deg);} to { transform: rotate(360deg);} }
      .table-head { font-size:12px; color: var(--muted); font-weight:600; text-transform: uppercase; margin: 4px 0; }
      .card.bad-bg { background: rgba(255,107,107,.08); border:1px solid rgba(255,107,107,.25); }
      .card.ok-bg { background: rgba(255,209,102,.08); border:1px solid rgba(255,209,102,.25); }
      .card.good-bg { background: rgba(6,214,160,.08); border:1px solid rgba(6,214,160,.25); }
      .card.compact { padding: 10px 12px; }
      .prompt-text { margin: 0; white-space: pre-wrap; font-family: inherit; font-size: 14px; line-height: 1.3; }
      .explain-text { margin: 0; font-size: 14px; line-height: 1.3; }
      .footer { text-align:center; color: var(--muted); font-size: 12px; margin: 16px 0 12px; }

      /* Stack columns on smaller screens to avoid overlap */
      @media (max-width: 900px) {
        .col-4, .col-6, .col-8 { grid-column: 1 / -1; }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="card">
        <h1>Prompt Engineering Trainer</h1>
        <p class="muted">Practice identifying prompt quality and improve your prompts with actionable feedback.</p>
        <div class="tabs">
          <div class="tab" :class="{active: tab==='evaluate'}" @click="tab='evaluate'">Evaluate</div>
          <div class="tab" :class="{active: tab==='quiz'}" @click="tab='quiz'">Quiz</div>
          <div class="tab" :class="{active: tab==='examples'}" @click="openExamples">Examples</div>
        </div>

        <div v-if="tab==='evaluate'">
          <div class="grid">
            <div class="col-6">
              <div class="section-title">Your Question</div>
              <textarea v-model="prompt" placeholder="Ask your question here... Be clear and specific."></textarea>
              <div style="margin-top:10px" class="row">
                <button @click="evaluate" :disabled="loading || !canAct" :title="!canAct ? 'Type a question first' : ''">{{ loading ? 'Evaluating‚Ä¶' : 'Evaluate' }}</button>
                <button class="ghost" @click="improve" :disabled="loading || !canAct" :title="!canAct ? 'Type a question first' : ''">{{ loading ? 'Improving‚Ä¶' : 'Improve Prompt' }}</button>
                <div v-if="loading" style="display:flex; align-items:center; gap:8px; flex:0;">
                  <span class="spinner"></span>
                  <span class="muted">Working‚Ä¶</span>
                </div>
              </div>
              <div v-if="improvedDraft" style="margin-top:10px">
                <div class="section-title">Improved Prompt</div>
                <textarea v-model="improvedDraft"></textarea>
              </div>
            </div>
            <div class="col-6">
              <div class="section-title">Result</div>
              <div v-if="result" class="card">
                <div class="row" style="align-items:baseline">
                  <div class="score">{{ result.score }}</div>
                  <div class="pill" :class="result.label">{{ result.label.toUpperCase() }}</div>
                </div>
                <p>{{ result.summary }}</p>
                <div class="section-title">Question Attributes</div>
                <div>
                  <div v-for="s in result.subscores" :key="s.name" class="subscore">
                    <div :class="['attr', qualityClass(s.score)]">{{ s.name }}</div>
                    <div class="emoji">{{ emoji(s.score) }}</div>
                  </div>
                </div>
                <div class="muted" style="margin-top:6px; font-size: 12px;">
                  Legend: <span class="attr bad">üòû needs work</span> ¬∑ <span class="attr ok">üòê okay</span> ¬∑ <span class="attr good">üòä strong</span>
                </div>
                <div class="section-title">Feedback</div>
                <ul>
                  <li v-for="f in result.feedback" :key="f">{{ f }}</li>
                </ul>
                <div class="section-title">Suggestions</div>
                <div v-for="s in result.suggestions" :key="s.title" class="suggestion">
                  <strong>{{ s.title }}:</strong> {{ s.text }}
                </div>
              </div>
            </div>
          </div>
        </div>

        <div v-if="tab==='quiz'">
          <div class="row" style="margin-bottom:8px">
            <button @click="loadQuiz">Load Quiz</button>
            <div v-if="quiz.length">{{ answered }}/{{ quiz.length }} answered</div>
          </div>
          <div v-for="item in quiz" :key="item.id" class="quiz-item">
            <div style="white-space:pre-wrap">{{ item.prompt }}</div>
            <div class="choices" style="margin-top:8px">
              <button @click="choose(item, 'bad')" :disabled="item._chosen">Bad</button>
              <button @click="choose(item, 'ok')" :disabled="item._chosen">Ok</button>
              <button @click="choose(item, 'good')" :disabled="item._chosen">Good</button>
            </div>
            <div v-if="item._chosen" style="margin-top:8px">
              <span class="pill" :class="item._correct ? 'good' : 'bad'">{{ item._correct ? 'Correct' : 'Incorrect' }}</span>
              <div class="muted" style="margin-top:6px">Expected: <strong>{{ item.label.toUpperCase() }}</strong> ‚Äî {{ item.rationale }}</div>
            </div>
          </div>
          <div v-if="quiz.length" class="row" style="margin-top:12px">
            <button @click="submitQuiz">Submit</button>
            <div v-if="quizResult">Score: {{ quizResult.score }} ({{ quizResult.correct }}/{{ quizResult.total }})</div>
          </div>
        </div>

        <div v-if="tab==='examples'">
          <div class="row" style="margin-bottom:8px">
            <button @click="randomExample" :disabled="examples.length===0">Random Prompt</button>
            <span class="muted" v-if="examples.length===0">Loading examples‚Ä¶</span>
          </div>
          <div v-if="currentExample" class="card bad-bg compact" style="margin-bottom:10px">
            <div class="section-title small">Bad Prompt</div>
            <div class="grid table-head tight">
              <div class="col-8"></div>
              <div class="col-4">Explanation</div>
            </div>
            <div class="grid tight">
              <div class="col-8"><pre class="prompt-text">{{ currentExample.bad }}</pre></div>
              <div class="col-4"><p class="muted explain-text">{{ currentExample.bad_explanation || 'Too vague or underspecified.' }}</p></div>
            </div>
          </div>
          <div v-if="currentExample" class="card ok-bg compact" style="margin-bottom:10px">
            <div class="section-title small">OK Prompt</div>
            <div class="grid table-head tight">
              <div class="col-8"></div>
              <div class="col-4">Explanation</div>
            </div>
            <div class="grid tight">
              <div class="col-8"><pre class="prompt-text">{{ currentExample.ok }}</pre></div>
              <div class="col-4"><p class="muted explain-text">{{ currentExample.ok_explanation || 'Clearer, but still missing key elements.' }}</p></div>
            </div>
          </div>
          <div v-if="currentExample" class="card good-bg compact" style="margin-bottom:10px">
            <div class="section-title small">Good Prompt</div>
            <div class="grid table-head tight">
              <div class="col-8"></div>
              <div class="col-4">Explanation</div>
            </div>
            <div class="grid tight">
              <div class="col-8"><pre class="prompt-text">{{ currentExample.good }}</pre></div>
              <div class="col-4"><p class="muted explain-text">{{ currentExample.good_explanation || 'Strong: clear, specific, and structured.' }}</p></div>
            </div>
          </div>
          <div v-if="currentExample" class="card">
            <div class="section-title">Detailed Explanation</div>
            <p class="muted" style="white-space:pre-wrap">{{ currentExample.details || 'This example adds context, constraints, and structure to guide a high-quality answer.' }}</p>
          </div>
        </div>
      </div>
    </div>

    <div class="footer">All content here has been generated using AI</div>

    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script>
      const API = 'http://localhost:8000';
      const { createApp, reactive } = Vue;

      createApp({
        data() {
          return {
            tab: 'evaluate',
            prompt: '',
            improvedDraft: '',
            result: null,
            loading: false,
            quiz: [],
            quizResult: null,
            examples: [],
            currentExample: null
          };
        },
        methods: {
          async openExamples() {
            this.tab = 'examples';
            if (this.examples.length === 0) {
              try {
                const res = await fetch(`${API}/api/examples`);
                this.examples = await res.json();
              } catch (e) {
                alert('Failed to load examples. Start the backend on 8000.');
              }
            }
          },
          async evaluate() {
            this.loading = true;
            this.result = null;
            try {
              const res = await fetch(`${API}/api/evaluate`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ prompt: this.prompt })
              });
              const data = await res.json();
              this.result = data;
              if (data && data.improved_prompt) {
                this.improvedDraft = data.improved_prompt;
              }
            } catch (e) {
              alert('Failed to reach API. Is the backend running on 8000?');
            } finally {
              this.loading = false;
            }
          },
          async improve() {
            this.loading = true;
            try {
              const res = await fetch(`${API}/api/evaluate`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ prompt: this.prompt })
              });
              const data = await res.json();
              this.improvedDraft = data && data.improved_prompt ? data.improved_prompt : '';
            } catch (e) {
              alert('Failed to improve. Is the backend running on 8000?');
            } finally {
              this.loading = false;
            }
          },
          emoji(val) {
            if (val <= 0) return 'üòû';
            if (val === 1) return 'üòê';
            return 'üòä';
          },
          qualityClass(val) {
            if (val <= 0) return 'bad';
            if (val === 1) return 'ok';
            return 'good';
          },
          async loadQuiz() {
            try {
              const res = await fetch(`${API}/api/quiz?limit=8`);
              const items = await res.json();
              this.quiz = items.map(it => ({ ...it, _chosen: null, _correct: null }));
              this.quizResult = null;
              this.tab = 'quiz';
            } catch (e) {
              alert('Failed to load quiz. Start the backend on 8000.');
            }
          },
          choose(item, label) {
            item._chosen = label;
            item._correct = (label === item.label);
          },
          async submitQuiz() {
            const answers = this.quiz.filter(i => i._chosen).map(i => ({ item_id: i.id, label: i._chosen }));
            if (!answers.length) return;
            try {
              const res = await fetch(`${API}/api/quiz/submit`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ answers })
              });
              this.quizResult = await res.json();
            } catch (e) {
              alert('Failed to submit quiz.');
            }
          },
          randomExample() {
            if (!this.examples.length) return;
            const idx = Math.floor(Math.random() * this.examples.length);
            this.currentExample = this.examples[idx];
          }
        },
        computed: {
          answered() { return this.quiz.filter(q => q._chosen).length; },
          canAct() { return (this.prompt || '').trim().length > 0; }
        }
      }).mount('body');
    </script>
  </body>
  </html>
